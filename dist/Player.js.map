{"version":3,"sources":["../src/Player.js"],"names":["MC","require","TimeCapsule","prefix","Player","constructor","options","clip","host","props","swipeAxis","mode","onwheel","handlePlainWheel","bind","journey","startJourney","addEventListener","_touchstart","_touchmove","transitionTimeout","transitionSpeed","easing","API","easings","transitionStart","chapters","sort","a","b","millisecond","transitioning","handleChapterWheel","_chapterTouchend","speedFactor","wheelSpeed","speed","scrollbarOptions","display","position","color","hasOwnProperty","Object","assign","progressBar","_setupScrollbar","scrollbarDiv","document","createElement","setAttribute","cssAttrs","variable","appendChild","subscribe","Date","getTime","ms","state","style","duration","ev","preventDefault","touches","length","previousTouch","clearTimeout","distance","event","direction","millisecondsDelta","newStation","runTimeInfo","currentMillisecond","destination","nextChpater","_getNextChapter","setTimeout","transitionToChapter","latency","_getPreviousChapter","i","chapter","deltaY","targetMillisecond","startMillisecond","window","requestAnimationFrame","_step","timestamp","progress","completed","station","easedProgress","Math","abs","easedMillisecond","module","exports"],"mappings":"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","sourcesContent":["const MC = require('@kissmybutton/motorcortex');\nconst TimeCapsule = new MC.TimeCapsule();\nconst prefix = '@kissmybutton/scrollbar_player';\n\nclass Player {\n    /**\n     * @param {object} options - The options object (optional). Supported options are:\n     * - clip: the Clip object\n     * - mode: one of chapters or free. If it is anchor then the clip will move back and forwards to anchor points\n     * - chapters: an array of objects each of which represents a chapter. The object has the following structure:\n     *  - name\n     *  - millisecond\n     * - wheelSpeed: a value from 1 to 10. Default 5\n     * - transitionSpeed: a number > 0 that defines the speed of the transition\n     * - swipeAxis: (either 'vertical' or 'horizontal'. Default = 'vertical')\n     * - easing: any of the supported MotorCortex easings\n     * - progressBar: an object with progressBar configuration:\n     *  - display: (boolean, default = true)\n     *  - color: the color of the scrollbar (default purple)\n     *  - position: (either \"left\", \"right\", \"top\" or \"bottom\", default \"right\")\n     **/\n    constructor(options = {}) {\n        this.clip = options.clip;\n        this.host = this.clip.props.host;\n        this.swipeAxis = (options.swipeAxis || 'vertical') === 'vertical' ? 'clientY' : 'clientX';\n\n        const mode = options.mode || \"free\";\n        if (mode === \"free\") {\n            this.host.onwheel = this.handlePlainWheel.bind(this);\n            this.journey = TimeCapsule.startJourney(this.clip);\n            this.host.addEventListener('touchstart', this._touchstart.bind(this));\n            this.host.addEventListener('touchmove', this._touchmove.bind(this));\n        }\n        else if (mode === \"chapters\") {\n            this.transitionTimeout = null;\n            this.transitionSpeed = options.transitionSpeed || 1;\n            this.easing = MC.API.easings[options.easing || 'easeOutQuart'];\n            this.transitionStart = null;\n            options.chapters.sort(function(a, b) {\n                return a.millisecond - b.millisecond;\n            });\n            this.chapters = options.chapters;\n            this.transitioning = false;\n            this.host.onwheel = this.handleChapterWheel.bind(this);\n            this.host.addEventListener('touchstart', this._touchstart.bind(this));\n            this.host.addEventListener('touchmove', this._touchmove.bind(this));\n            this.host.addEventListener('touchend', this._chapterTouchend.bind(this));\n        }\n\n        const speedFactor = 5 / (options.wheelSpeed || 5);\n        this.speed = 1 / speedFactor;\n\n        let scrollbarOptions = {\n            display: true,\n            position: 'right',\n            color: 'purple'\n        };\n        if (options.hasOwnProperty('progressBar')) {\n            Object.assign(scrollbarOptions, options.progressBar);\n        }\n        this._setupScrollbar(scrollbarOptions);\n    }\n\n    _setupScrollbar(options) {\n        if (options.display === false) {\n            return;\n        }\n\n        const scrollbarDiv = document.createElement('div');\n        scrollbarDiv.setAttribute('id', `${prefix}-scrollbarId`);\n\n        let cssAttrs;\n        let variable;\n        switch (options.position) {\n            case 'left':\n                cssAttrs = 'left:0px; top: 0px; width: 2px; height: 0%;';\n                variable = 'height';\n                break;\n            case 'right':\n                cssAttrs = 'right:0px; top: 0px; width: 2px; height: 0%;';\n                variable = 'height';\n                break;\n            case 'top':\n                cssAttrs = 'top:0px; left: 0px; height: 2px; width: 0%;';\n                variable = 'width';\n                break;\n            case 'bottom':\n                cssAttrs = 'bottom:0px; left: 0px; height: 2px; width: 0%;';\n                variable = 'width';\n                break;\n        }\n\n        scrollbarDiv.setAttribute('style', `${cssAttrs} position:absolute; background: ${options.color};`);\n        this.host.appendChild(scrollbarDiv);\n        this.clip.subscribe(`${prefix}_${new Date().getTime()}`, (ms, state) => {\n            scrollbarDiv.style[variable] = `${100*ms/this.clip.duration}%`;\n        });\n    }\n\n    _touchstart(ev) {\n        ev.preventDefault();\n        if (ev.touches.length === 1) {\n            this.previousTouch = ev.touches[0][this.swipeAxis];\n            this.transitioning = false;\n        }\n    }\n\n    _touchmove(ev) {\n        ev.preventDefault();\n        this.transitioning = false;\n        if (this.transitionTimeout !== null) {\n            clearTimeout(this.transitionTimeout);\n        }\n\n        const distance = this.previousTouch - event.touches[0][this.swipeAxis];\n\n        if (distance > 0) {\n            this.direction = 'fw';\n        }\n        else {\n            this.direction = 'bw';\n        }\n\n        this.previousTouch = event.touches[0][this.swipeAxis];\n        let millisecondsDelta = 10 * distance * this.speed;\n        const journey = TimeCapsule.startJourney(this.clip);\n        let newStation = this.clip.runTimeInfo.currentMillisecond + millisecondsDelta;\n\n        if (newStation < 0) {\n            newStation = 0;\n            millisecondsDelta = 0;\n        }\n        else if (newStation > this.clip.duration) {\n            newStation = this.clip.duration;\n            millisecondsDelta = 0;\n        }\n\n        journey.destination(newStation);\n    }\n\n    _chapterTouchend(event) {\n        event.preventDefault();\n\n        if (this.direction === 'fw' && this.clip.runTimeInfo.currentMillisecond !== this.clip.duration) {\n            const nextChpater = this._getNextChapter(this.clip.runTimeInfo.currentMillisecond);\n            this.transitionTimeout = setTimeout(() => {\n                this.transitionToChapter(nextChpater, 'fw');\n            }, this.latency);\n        }\n        else if (this.direction === 'bw' && this.clip.runTimeInfo.currentMillisecond !== 0) {\n            const nextChpater = this._getPreviousChapter(this.clip.runTimeInfo.currentMillisecond);\n            this.transitionTimeout = setTimeout(() => {\n                this.transitionToChapter(nextChpater, 'bw');\n            }, this.latency);\n        }\n    }\n\n    _getNextChapter(millisecond) {\n        for (let i = 0; i < this.chapters.length; i++) {\n            const chapter = this.chapters[i];\n            if (chapter.millisecond > millisecond) {\n                return chapter.millisecond;\n            }\n        }\n        return this.clip.duration;\n    }\n\n    _getPreviousChapter(millisecond) {\n        for (let i = this.chapters.length - 1; i >= 0; i--) {\n            const chapter = this.chapters[i];\n            if (chapter.millisecond < millisecond) {\n                return chapter.millisecond;\n            }\n        }\n        return 0;\n    }\n\n    handleChapterWheel(event) {\n        event.preventDefault();\n        this.transitioning = false;\n        if (this.transitionTimeout !== null) {\n            clearTimeout(this.transitionTimeout);\n        }\n\n        let millisecondsDelta = event.deltaY * this.speed;\n\n        const journey = TimeCapsule.startJourney(this.clip);\n        let newStation = this.clip.runTimeInfo.currentMillisecond + millisecondsDelta;\n\n        if (newStation < 0) {\n            newStation = 0;\n            millisecondsDelta = 0;\n        }\n        else if (newStation > this.clip.duration) {\n            newStation = this.clip.duration;\n            millisecondsDelta = 0;\n        }\n\n        if (millisecondsDelta > 0) {\n            const nextChpater = this._getNextChapter(newStation);\n            this.transitionTimeout = setTimeout(() => {\n                this.transitionToChapter(nextChpater, 'fw');\n            }, this.latency);\n        }\n        else if (millisecondsDelta < 0) {\n            const nextChpater = this._getPreviousChapter(newStation);\n            this.transitionTimeout = setTimeout(() => {\n                this.transitionToChapter(nextChpater, 'bw');\n            }, this.latency);\n        }\n\n        journey.destination(newStation);\n    }\n\n    transitionToChapter(millisecond) {\n        this.transitioning = true;\n        this.transitionStart = null;\n        this.targetMillisecond = millisecond;\n        this.startMillisecond = this.clip.runTimeInfo.currentMillisecond;\n        this.journey = TimeCapsule.startJourney(this.clip);\n        this.direction = this.targetMillisecond >= this.startMillisecond ? 'fw' : 'bw';\n        window.requestAnimationFrame(this._step.bind(this));\n    }\n\n    _step(timestamp) {\n        if (this.transitionStart === null) {\n            this.transitionStart = timestamp;\n        }\n        const progress = timestamp - this.transitionStart;\n        let completed = false;\n        let station;\n        if (this.direction === 'fw') {\n            station = this.startMillisecond + progress * this.transitionSpeed;\n            if (station > this.targetMillisecond) {\n                station = this.targetMillisecond;\n                completed = true;\n            }\n        }\n        else {\n            station = this.startMillisecond - progress * this.transitionSpeed;\n            if (station < this.targetMillisecond) {\n                station = this.targetMillisecond;\n                completed = true;\n            }\n        }\n\n        if (this.transitioning === false) {\n            return;\n        }\n\n        const easedProgress = Math.abs(station - this.startMillisecond) / Math.abs(this.targetMillisecond - this.startMillisecond);\n        let easedMillisecond;\n        if (this.direction === 'fw') {\n            easedMillisecond = this.startMillisecond + this.easing(easedProgress) * (this.targetMillisecond - this.startMillisecond);\n        }\n        else {\n            easedMillisecond = this.startMillisecond - this.easing(easedProgress) * (this.startMillisecond - this.targetMillisecond);\n        }\n        this.journey.station(easedMillisecond);\n        if (completed) {\n            this.journey.destination();\n        }\n        else {\n            window.requestAnimationFrame(this._step.bind(this));\n        }\n    }\n\n    handlePlainWheel(event) {\n        event.preventDefault();\n\n        const millisecondsDelta = event.deltaY * this.speed;\n        let newStation = this.clip.runTimeInfo.currentMillisecond + millisecondsDelta;\n        if (newStation < 0) {\n            newStation = 0;\n        }\n        else if (newStation > this.clip.duration) {\n            newStation = this.clip.duration;\n        }\n        this.journey.station(newStation);\n    }\n}\n\nmodule.exports = Player;\n"],"file":"Player.js"}